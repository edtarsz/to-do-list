<div class="w-full h-full rounded-2xl p-[1.5vw] flex flex-col gap-[1vw]">
    <div class="flex items-center justify-between font-family-ubuntu-mono-bold">
        <h1 class="text-2xl lg:text-[2vw]">{{ currentMonth }}, {{ currentYear }}</h1>
        <div class="flex items-center gap-[1vw]">
            <app-icon-text-button (click)="previousWeek()" [color]="'black'" [iconSvg]="arrowBackIcon.svg"
                [viewBox]="arrowBackIcon.viewBox" [iconSize]="'14'" [bgColor]="'var(--secondary-color)'">
            </app-icon-text-button>

            <app-icon-text-button [text]="weekNumber" [color]="'black'" [bgColor]="'var(--secondary-color)'">
            </app-icon-text-button>

            <app-icon-text-button (click)="nextWeek()" [color]="'black'" [iconSvg]="arrowNextIcon.svg"
                [viewBox]="arrowNextIcon.viewBox" [iconSize]="'14'" [bgColor]="'var(--secondary-color)'">
            </app-icon-text-button>
        </div>
    </div>

    <!-- days -->
    <div class="grid grid-cols-8 items-center gap-[0.5vw]">
        <div class="m-auto opacity-0">
            <app-icon-text-button [color]="'black'" [iconSvg]="arrowBackIcon.svg" [viewBox]="'0 0 12 8'"
                [iconSize]="'14'" [bgColor]="'var(--secondary-color)'">
            </app-icon-text-button>
        </div>
        @for (day of weekDays; track $index) {
        <div class="flex flex-col text-center bg-[var(--secondary-color)] rounded-lg py-[0.5vw]">
            <span class="text-[var(--gray)] block text-xs">{{ day.name }}</span>
            <h2 class="text-[1.8vw] font-family-ubuntu-mono-bold">{{ day.date }}</h2>
        </div>
        }
    </div>

    <hr class="border-[#1f1f1f20] border-t-2 border-dashed" />

    <!-- All Day Tasks Section (extendidas por dÃ­as) -->
    @if (getMultiDayTaskLayers().length > 0) {
    <div class="grid grid-cols-8 gap-[0.5vw] pb-[1vw] border-b border-[#1f1f1f20] border-dashed">
        <div class="text-[var(--gray)] text-sm font-family-ubuntu-mono-bold flex items-start justify-center pt-2">
            All Day
        </div>
        <div class="col-span-7 relative" [style.min-height.px]="getMultiDayTaskLayers().length * 55">
            @for (layer of getMultiDayTaskLayers(); track $index; let layerIndex = $index) {
            @for (task of layer; track task.id) {
            @let taskSpan = getTaskSpan(task);
            @if (taskSpan.span > 0) {
            <div class="absolute rounded-lg text-white text-xs p-2 shadow-md cursor-pointer hover:shadow-lg transition-all font-family-ubuntu-mono-bold"
                [style.background-color]="getTaskColor(task)"
                [style.left]="'calc(' + ((taskSpan.startIndex / 7) * 100) + '% + 2px)'"
                [style.width]="'calc(' + ((taskSpan.span / 7) * 100) + '% - 4px)'" [style.top.px]="layerIndex * 55"
                [style.height.px]="48" (click)="openTaskDetails(task)">
                <div class="flex items-center justify-between h-full gap-2">
                    <div class="flex-1 truncate text-white font-bold">
                        {{ task.name }}
                    </div>
                    <div class="text-[10px] text-white/80 whitespace-nowrap">
                        {{ getTaskDateRange(task) }}
                    </div>
                </div>
            </div>
            }
            }
            }
        </div>
    </div>
    }

    <!-- main grid -->
    <div class="relative w-full h-full overflow-auto scrollbar-hide">
        <div class="grid grid-cols-8 w-full h-full gap-[0.5vw] relative">
            <div class="relative top-3 flex flex-col text-[var(--gray)] text-sm font-family-ubuntu-mono items-center">
                @for (hour of hours; track $index) {
                <div class="h-[10vh] flex items-start font-family-ubuntu-mono-bold">{{ hour }}</div>
                }
            </div>

            <div class="col-span-7 relative">
                <div class="w-full relative top-5">
                    @for (hour of hours; track $index) {
                    <div class="absolute left-0 right-0 border-t-1 border-[#1f1f1f15]"
                        [ngStyle]="{ top: 'calc(' + $index * 10 + 'vh)' }">
                    </div>
                    }
                </div>

                <div class="grid grid-cols-7 h-full relative">
                    @for (day of weekDays; track $index) {
                    <div class="relative h-full">
                        @for (group of getTaskGroups(day); track $index) {
                        <div class="absolute left-[5%] right-[5%] rounded-lg text-white text-xs p-2 shadow-md cursor-pointer hover:opacity-90 transition-all"
                            [style.background-color]="getTaskColor(group[0])"
                            [style.top]="getTaskTopPosition(getGroupStartTime(group))"
                            [style.height]="getTaskHeight(getGroupStartTime(group), getGroupEndTime(group))"
                            (click)="openTaskDetails(group[0])">

                            <div class="flex flex-col gap-1 h-full overflow-hidden">
                                @for (task of group; track task.id) {
                                <div class="p-1.5 rounded" [style.background-color]="getTaskColor(task)">
                                    <div class="font-bold truncate text-white">{{ task.name }}</div>
                                    <div class="text-[10px] text-white/70">
                                        {{ task.startTime }} - {{ task.dueTime }}
                                    </div>
                                </div>
                                }
                            </div>
                        </div>
                        }
                    </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>